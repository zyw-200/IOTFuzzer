#!/bin/sh

DEFAULT_SERVER=$1
DATE_SERVER_1="pool.ntp.org"
DATE_SERVER_2="time.nist.gov"

# Function will check the give server and exit the program
# if it could successfully reach the server
check_ntp_date()
{
	/usr/local/bin/ntpdate -u $1 2 > /dev/null 2>&1
	if [ $? -eq 0 ]; then
		/bin/echo "1"  > /tmp/testNTP
		/usr/local/bin/sc_radio < /var/config
		exit 0;
	else
		logger "Unable to update NTP date from '$1' server."
		/bin/echo "0" > /tmp/testNTP
		return 1
	fi
}

while true
do
	/bin/sleep 30
        # Check the default which we got from command line
	check_ntp_date $DEFAULT_SERVER
        # Check the fallbacks
	check_ntp_date $DATE_SERVER_1
	check_ntp_date $DATE_SERVER_2
done

