#!/bin/sh

HANDSOFF="/* Automagically generated by mkallmodules, DO NOT EDIT */"

(
	echo "$HANDSOFF"
	echo

	for m in $@ ; do
		echo "#ifndef LLCONF"
		echo "#  include <llconf/${m}.h>"
		echo "#else"
		echo "#  include \"${m}.h\""
		echo "#endif"
		echo	
	done

	echo "void register_all();"

) > allmodules.h

(
	echo "$HANDSOFF"
	echo

	echo "#include <stdio.h>"
	echo "#include <stdlib.h>"
	echo "#include \"modules.h\""
	echo "#include \"nodes.h\""
	echo "#include \"allmodules.h\""
	echo
	echo "void register_all()"
	echo "{"
	for m in $@ ; do
		echo "  register_${m}(NULL);"
	done
	echo "}"
) > allmodules.c

